"use strict";var E=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(a,l)=>{for(var o in l)E(a,o,{get:l[o],enumerable:!0})},ee=(a,l,o,n)=>{if(l&&typeof l=="object"||typeof l=="function")for(let i of X(l))!Y.call(a,i)&&i!==o&&E(a,i,{get:()=>l[i],enumerable:!(n=U(l,i))||n.enumerable});return a};var te=a=>ee(E({},"__esModule",{value:!0}),a);var se={};Z(se,{initCarousel:()=>ne});module.exports=te(se);var L=require("./swipeEvents");const ne=(a,l)=>{const o="carousel";let n=[0],i=[0];const m={},H=4,{onViewChangeStart:v,onViewChangeEnd:k,excludeSwipeSupport:T,useMaxHeight:$}=l||{},V=(e,t)=>{m[e]=t},A=(e,t)=>{if(e.querySelector(`.${t}`))return;const r=document.createElement("div");for(r.classList.add(`${t}`);e.firstChild;)r.appendChild(e.firstChild);e.appendChild(r)},R=()=>n.map(e=>({id:e,elem:m[e]})),_=()=>{const e=Object.keys(m).length,t=m[e-1],r=R();return{currentIndex:n[0],lastIndex:parseInt(t?.dataset.index||n[0].toString(),10),totalViews:e,historyStack:r}},M=()=>{i=[...n];const e=_();v?.(e)},y=e=>{if(!e)return;const t=e.dataset.index;if(t&&n[0]===parseInt(t,10)){const r=_();k?.(r)}},w=e=>{const r=Object.keys(m).length-1;return Math.max(0,Math.min(e,r))},b=e=>{const t=w(e);n[0]!==t&&(M(),n=[t,...n],d(!1))},I=e=>{y(e)},W=(e,t,r,s,c)=>{e.classList.add(`${o}__view`),e.classList.toggle(`${o}__view-in-stack`,t&&!r),e.classList.toggle(`${o}__view-active`,t&&r),c&&!s&&e.classList.add(`${o}__view-recycle-in`),!c&&s&&e.classList.add(`${o}__view-recycle-out`)},q=e=>{e.classList.remove(`${o}__view-recycle-in`,`${o}__view-recycle-out`)},x=e=>e*parseFloat(getComputedStyle(document.documentElement).fontSize),C=e=>{const t=x(H);if(a.clientHeight<t){e<t&&(e=t);const s=a.querySelector(`.${o}__itemsWrapper`);s&&(s.style.blockSize=`${e}px`)}},d=e=>{let t=0,r=0;Array.from(p).forEach((s,c)=>{const P=n.findIndex(u=>u===c),S=i.filter(u=>u===c).length,B=i.length>n.length&&i[0]===c&&S>0,G=i.length<n.length&&n[0]===c&&S>0,J=P>-1,K=c===n[0];if(W(s,J,K,B,G),e){V(c,s),setTimeout(()=>{if($){const h=Array.from(p).map(Q=>Q.scrollHeight);r=Math.max(...h),s.style.position="absolute",C(r)}else(!t||s.offsetHeight<t&&t>x(H))&&(t=s.offsetHeight),s.style.position="absolute",C(t)});const u=h=>{q(s),h.target===m[n[0]]&&I(s)};s._carouselListener=u,s.addEventListener("animationend",u),s.addEventListener("transitionend",u),s.setAttribute("data-index",c.toString())}}),e&&y(Array.from(p)[0])},f=()=>{const e=n[0]+1;b(e)},g=()=>{n.length-1>=1&&(M(),n=n.slice(1),d(!1))},z=e=>{b(e)},j=()=>({index:n[0],item:m[n[0]]}),D=()=>{n=[0],d(!1)},O=()=>{Object.values(m).forEach(e=>{const t=e;e&&t._carouselListener&&(e.removeEventListener("animationend",t._carouselListener),e.removeEventListener("transitionend",t._carouselListener))}),T||(0,L.registerSwipeEvents)(a,f,g,!0)},F=e=>{const t=e.querySelector("slot");return t?t.assignedElements({flatten:!0}):Array.from(e.children)};A(a,`${o}__itemsWrapper`);const N=a.querySelector(`.${o}__itemsWrapper`),p=F(N);return a.classList.add(`${o}__view-stack`),d(!0),T||(0,L.registerSwipeEvents)(a,f,g,!1),{next:f,prev:g,reset:D,goToIndex:z,getActiveItem:j,destroyEvents:O,allViews:m}};
