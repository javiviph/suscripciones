import{registerSwipeEvents as x}from"./swipeEvents";const ne=(i,C)=>{const r="carousel";let n=[0],m=[0];const l={},h=4,{onViewChangeStart:S,onViewChangeEnd:v,excludeSwipeSupport:E,useMaxHeight:k}=C||{},$=(e,t)=>{l[e]=t},V=(e,t)=>{if(e.querySelector(`.${t}`))return;const o=document.createElement("div");for(o.classList.add(`${t}`);e.firstChild;)o.appendChild(e.firstChild);e.appendChild(o)},A=()=>n.map(e=>({id:e,elem:l[e]})),L=()=>{const e=Object.keys(l).length,t=l[e-1],o=A();return{currentIndex:n[0],lastIndex:parseInt(t?.dataset.index||n[0].toString(),10),totalViews:e,historyStack:o}},H=()=>{m=[...n];const e=L();S?.(e)},T=e=>{if(!e)return;const t=e.dataset.index;if(t&&n[0]===parseInt(t,10)){const o=L();v?.(o)}},R=e=>{const o=Object.keys(l).length-1;return Math.max(0,Math.min(e,o))},_=e=>{const t=R(e);n[0]!==t&&(H(),n=[t,...n],u(!1))},w=e=>{T(e)},I=(e,t,o,s,a)=>{e.classList.add(`${r}__view`),e.classList.toggle(`${r}__view-in-stack`,t&&!o),e.classList.toggle(`${r}__view-active`,t&&o),a&&!s&&e.classList.add(`${r}__view-recycle-in`),!a&&s&&e.classList.add(`${r}__view-recycle-out`)},W=e=>{e.classList.remove(`${r}__view-recycle-in`,`${r}__view-recycle-out`)},M=e=>e*parseFloat(getComputedStyle(document.documentElement).fontSize),y=e=>{const t=M(h);if(i.clientHeight<t){e<t&&(e=t);const s=i.querySelector(`.${r}__itemsWrapper`);s&&(s.style.blockSize=`${e}px`)}},u=e=>{let t=0,o=0;Array.from(g).forEach((s,a)=>{const N=n.findIndex(c=>c===a),b=m.filter(c=>c===a).length,P=m.length>n.length&&m[0]===a&&b>0,B=m.length<n.length&&n[0]===a&&b>0,G=N>-1,J=a===n[0];if(I(s,G,J,P,B),e){$(a,s),setTimeout(()=>{if(k){const p=Array.from(g).map(K=>K.scrollHeight);o=Math.max(...p),s.style.position="absolute",y(o)}else(!t||s.offsetHeight<t&&t>M(h))&&(t=s.offsetHeight),s.style.position="absolute",y(t)});const c=p=>{W(s),p.target===l[n[0]]&&w(s)};s._carouselListener=c,s.addEventListener("animationend",c),s.addEventListener("transitionend",c),s.setAttribute("data-index",a.toString())}}),e&&T(Array.from(g)[0])},d=()=>{const e=n[0]+1;_(e)},f=()=>{n.length-1>=1&&(H(),n=n.slice(1),u(!1))},q=e=>{_(e)},z=()=>({index:n[0],item:l[n[0]]}),j=()=>{n=[0],u(!1)},D=()=>{Object.values(l).forEach(e=>{const t=e;e&&t._carouselListener&&(e.removeEventListener("animationend",t._carouselListener),e.removeEventListener("transitionend",t._carouselListener))}),E||x(i,d,f,!0)},O=e=>{const t=e.querySelector("slot");return t?t.assignedElements({flatten:!0}):Array.from(e.children)};V(i,`${r}__itemsWrapper`);const F=i.querySelector(`.${r}__itemsWrapper`),g=O(F);return i.classList.add(`${r}__view-stack`),u(!0),E||x(i,d,f,!1),{next:d,prev:f,reset:j,goToIndex:q,getActiveItem:z,destroyEvents:D,allViews:l}};export{ne as initCarousel};
